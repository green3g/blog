<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <meta name="author" content="roemhildtg"> 
  <link rel="canonical" href="http://roemhildtg.github.io/2016/January/ArcMap Advanced Label/"> 
  <link rel="shortcut icon" href="../../../img/favicon.ico">

  <title>ArcMap Advanced Label - Thoughts and Ramblings</title>

  <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
  <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
  <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
  <link href="../../../css/base.css" rel="stylesheet">
  <link href="../../../css/cinder.css" rel="stylesheet">
  <link rel="stylesheet" href="../../../css/highlight.css">

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
  <script>
    WebFont.load({
      google: {
        families: ['Open Sans', 'PT Sans']
      }
    });
  </script>

  
</head>

<body>

  <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../../..">Thoughts and Ramblings</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">2015 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">January</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../2015/January/ArcMap Metadata Update/">ArcMap Metadata Update</a>
</li>

        
            
<li >
    <a href="../../../2015/January/Install Skype In OpenSUSE/">Install Skype In OpenSUSE</a>
</li>

        
            
<li >
    <a href="../../../2015/January/MP495 Install Linux/">MP495 Install Linux</a>
</li>

        
            
<li >
    <a href="../../../2015/January/Quick Media Center/">Quick Media Center</a>
</li>

        
            
<li >
    <a href="../../../2015/January/Sharepoint Scroll Bug/">Sharepoint Scroll Bug</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">2016 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">February</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../February/OGR Cheatsheet/">OGR Cheatsheet</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">January</a>
    <ul class="dropdown-menu">
        
            
<li class="active">
    <a href="./">ArcMap Advanced Label</a>
</li>

        
            
<li >
    <a href="../Long File Names/">Long File Names</a>
</li>

        
            
<li >
    <a href="../Openlayers 3 Custom Projection/">Openlayers 3 Custom Projection</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Projects <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../Projects/CMV/">CMV</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../../February/OGR Cheatsheet/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../Long File Names/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="http://github.com/roemhildtg/blog">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

  <div class="container">
    
    <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#advanced-labeling-in-arcmap-one-feature-many-labels">Advanced Labeling in ArcMap - One feature, many labels</a></li>
        
    
    </ul>
</div></div>
    <div class="col-md-9" role="main">

<h1 id="advanced-labeling-in-arcmap-one-feature-many-labels">Advanced Labeling in ArcMap - One feature, many labels</h1>
<p>When labeling items, sometimes you may want to have multiple values for a label, like for example, a polygon may contain several different zoning codes in a city block. How can we label each block with the specific zones that it it contains?</p>
<p>Essentially, we have three tables:</p>
<p>A polygon block table with the block ID</p>
<table>
<thead>
<tr>
<th>Block ID</th>
<th>SHAPE</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Polygon</td>
</tr>
<tr>
<td>2</td>
<td>Polygon</td>
</tr>
<tr>
<td>3</td>
<td>Polygon</td>
</tr>
<tr>
<td>4</td>
<td>Polygon</td>
</tr>
</tbody>
</table>
<p>A polygon zone table with a zone code</p>
<table>
<thead>
<tr>
<th>Zone Code</th>
<th>SHAPE</th>
</tr>
</thead>
<tbody>
<tr>
<td>Com</td>
<td>Polygon</td>
</tr>
<tr>
<td>Res</td>
<td>Polygon</td>
</tr>
<tr>
<td>Ind</td>
<td>Polygon</td>
</tr>
</tbody>
</table>
<p>We can do a spatial join that is one to many Zone polygons to Block polygons which produces a 3rd table.</p>
<table>
<thead>
<tr>
<th>Zone Code</th>
<th>Block ID</th>
<th>SHAPE</th>
</tr>
</thead>
<tbody>
<tr>
<td>Com</td>
<td>1</td>
<td>Polygon</td>
</tr>
<tr>
<td>Ind</td>
<td>1</td>
<td>Polygon</td>
</tr>
<tr>
<td>Res</td>
<td>1</td>
<td>Polygon</td>
</tr>
<tr>
<td>Ind</td>
<td>3</td>
<td>Polygon</td>
</tr>
<tr>
<td>Com</td>
<td>3</td>
<td>Polygon</td>
</tr>
<tr>
<td>Com</td>
<td>2</td>
<td>Polygon</td>
</tr>
<tr>
<td>Res</td>
<td>4</td>
<td>Polygon</td>
</tr>
</tbody>
</table>
<p>Now we can relate the Block table (#1) to the Zone-Block table (#3)</p>
<p>The script below helps automate this by accepting a function and the table names as parameters and outputting the formatted lines for each one-many item.</p>
<pre><code class="python"># Calculates the dynamic expression for a layer and can be used
# to dynamically display related records text for data driven pages
# or feature labels

# Change the FindLabel parameter to the id field of the main table (ArcMap uses brackets in the [Field_Name])
# This id should be related to each of the related tables
# Also change the first line of FindLabel. Set parameter equal to the FindLabel parameter
def FindLabel ( [Block_ID] ):
    return get_lookup_text([Block_ID])

# create formatter functions to return what you want displayed
# for each row. These should return plain text for each row.

# returns a string with the block zone
def get_block(row):
    return row[&quot;Zone_Code&quot;]

# change the lookup tables and assign their appropriate formatter function
# Properties of each lookup item:
# table: the name of the table in the mxd
# row_formatter: the function that will format each row's properties and return
# the text string
# id_field: the name of the field in the table that is related to the
# id passed in to FindLabel
# fields: list of fields by name (optiononal) default '*'
lookup_tables = [{
    &quot;table&quot;: &quot;Related_Zones&quot;,
    &quot;row_formatter&quot;: get_parcel,
    &quot;id_field&quot;: &quot;Block ID&quot;,
    &quot;fields&quot;: ['Block_ID', 'Zone_Code'],
    &quot;header&quot;: 'Block Zones:',
},
#other lookup tables...
]

#the guts
def get_lookup_text(id):
    # init the return value
    text = ''
    if id is not None:
        for table in lookup_tables:
            if table.has_key('header'):
                text += &quot;{} \n&quot;.format(table['header'])
            if type(id) is str or type(id) is unicode:
                query = &quot;{} = '{}'&quot;.format(table[&quot;id_field&quot;], id)
            else:
                query = &quot;{} = {}&quot;.format(table[&quot;id_field&quot;], id)
            fields = table['fields'] if table.has_key('fields') else '*'
            with arcpy.da.SearchCursor(table[&quot;table&quot;], fields, where_clause=query) as rows:
                for row in rows:
                    dictionary = dict()
                    for idx, val in enumerate(rows.fields):
                        dictionary[val] = row[idx]
                    text += &quot;{} \n&quot;.format(table[&quot;row_formatter&quot;](dictionary))
    return text
</code></pre></div>
    
    <div id="disqus_thread"></div>
    <script>
      /**
       *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
       *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
       */
      /*
      var disqus_config = function () {
          this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
          this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      };
      */
      (function() { // DON'T EDIT BELOW THIS LINE
        var d = document,
          s = d.createElement('script');

        s.src = '//roemhildtg.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
    <script id="dsq-count-scr" src="//roemhildtg.disqus.com/count.js" async></script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>

  <footer class="col-md-12 text-center">
    <hr>
    <p>
      <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
  </footer>

  <script src="../../../js/jquery-1.10.2.min.js"></script>
  <script src="../../../js/bootstrap-3.0.3.min.js"></script>
  <script src="../../../js/highlight.pack.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  <script>
    var base_url = '../../..';
  </script>
  <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
  <script src="../../../js/base.js"></script>

  <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">
            <span aria-hidden="true">&times;</span>
            <span class="sr-only">Close</span>
          </button>
          <h4 class="modal-title" id="exampleModalLabel">Search</h4>
        </div>
        <div class="modal-body">
          <p>
            From here you can search these documents. Enter your search terms below.
          </p>
          <form role="form">
            <div class="form-group">
              <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
            </div>
          </form>
          <div id="mkdocs-search-results"></div>
        </div>
        <div class="modal-footer">
        </div>
      </div>
    </div>
  </div>

  </body>

</html>
